---
import LoadingOverlay from "../components/loading_overlay.astro";
import ProjectTile from "../components/project_tile.astro";
import LogoTile from "../components/logo_tile.astro";
import "../styles/global.css";

const projects = [
    {
        image: "/images/img_1.jpg",
        alt: "Project 1 image",
        title: "Courtyard Housing",
        subtitle: "Medium-density urban infill",
        year: "2024",
        location: "Ghent, BE",
        role: "Concept & design",
        description:
            "A series of interlocking courtyard dwellings that mediate between historic brick fabric and contemporary low-energy construction."
    },
    {
        image: "/images/img_2.jpg",
        alt: "Project 2 image",
        title: "Riverfront Pavilion",
        subtitle: "Timber public structure",
        year: "2023",
        location: "Antwerp, BE",
        role: "Design research",
        description:
            "Lightweight CLT pavilion exploring reversible detailing and demountable public infrastructure along the waterfront."
    },
    {
        image: "/images/img_3.jpg",
        alt: "Project 3 image",
        title: "Vertical Studio",
        subtitle: "Academic mixed-use tower",
        year: "2022",
        location: "Rotterdam, NL",
        role: "Studio project",
        description:
            "A vertical campus stitching together teaching, fabrication, and exhibition spaces within a compact urban footprint."
    },
    {
        image: "/images/img_4.jpg",
        alt: "Project 4 image",
        title: "Field Lab",
        subtitle: "Agricultural prototype",
        year: "2022",
        location: "Flanders, BE",
        role: "Prototype & detailing",
        description:
            "Modular field lab combining low-tech climate control with high-tech sensing for site-specific agricultural research."
    },
    {
        image: "/images/img_5.jpg",
        alt: "Project 5 image",
        title: "Civic Stair",
        subtitle: "Public realm intervention",
        year: "2021",
        location: "Brussels, BE",
        role: "Urban strategy",
        description:
            "An inhabitable stair that amplifies existing desire paths, connecting fragmented public spaces across a steep topography."
    },
    {
        image: "/images/img_6.jpg",
        alt: "Project 6 image",
        title: "Workshop Annex",
        subtitle: "Adaptive re-use",
        year: "2021",
        location: "Leuven, BE",
        role: "Detail design",
        description:
            "A steel-framed insertion that reactivates a disused industrial shed as a fabrication annex for students and researchers."
    },
    {
        image: "/images/img_7.jpg",
        alt: "Project 7 image",
        title: "Quiet Library",
        subtitle: "Micro-library prototype",
        year: "2020",
        location: "Ghent, BE",
        role: "Full design",
        description:
            "Compact timber structure exploring acoustic performance, daylight modulation, and intimate study atmospheres."
    },
    {
        image: "/images/img_8.jpg",
        alt: "Project 8 image",
        title: "Sectional Garden",
        subtitle: "Landscape-section study",
        year: "2020",
        location: "Online studio",
        role: "Research & drawing",
        description:
            "Speculative landscape formed through a series of analytical sections, linking soil ecologies with architectural form."
    }
];
---

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lnp.</title>
</head>

<LoadingOverlay />

<div class="grid">
    {projects.slice(0, 4).map((p, idx) => (
            <ProjectTile {...p} index={idx} />
    ))}

    <LogoTile
            title="lnp."
            slogan="contemporary ataraxia."
            index={4}
    />

    {projects.slice(4).map((p, idx) => (
            <ProjectTile {...p} index={idx + 5} />
    ))}
</div>

<!-- Project details side-sheet / bottom sheet -->
<div id="project-panel" class="project-panel" aria-hidden="true">
    <div class="project-panel-backdrop"></div>

    <aside class="project-panel-sheet" role="dialog" aria-modal="true">
        <button
                class="project-panel-close"
                type="button"
                aria-label="Close project details"
        >
            ×
        </button>

        <div class="project-panel-image-wrap">
            <img id="project-panel-image" src="" alt="" />
        </div>

        <div class="project-panel-body">
            <p class="panel-kicker" id="project-panel-kicker"></p>
            <h2 id="project-panel-title"></h2>
            <p class="panel-subtitle" id="project-panel-subtitle"></p>

            <dl class="panel-meta">
                <div>
                    <dt>Year</dt>
                    <dd id="project-panel-year"></dd>
                </div>
                <div>
                    <dt>Location</dt>
                    <dd id="project-panel-location"></dd>
                </div>
                <div>
                    <dt>Role</dt>
                    <dd id="project-panel-role"></dd>
                </div>
            </dl>

            <p class="panel-description" id="project-panel-description"></p>
        </div>
    </aside>
</div>

<style>
    .project-panel {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 9000;
    }

    .project-panel.is-open {
        display: block;
    }

    .project-panel-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        opacity: 0;
        transition: opacity var(--transition-med, 0.3s ease);
    }

    .project-panel-sheet {
        position: absolute;
        top: 0;
        right: 0;
        width: min(420px, 100vw);
        height: 100vh;
        background: var(--colour-bg);
        box-shadow: -20px 0 40px rgba(0, 0, 0, 0.25);
        transform: translateX(100%);
        transition: transform var(--transition-med, 0.3s ease);
        display: flex;
        flex-direction: column;
    }

    .project-panel.is-open .project-panel-backdrop {
        opacity: 1;
    }

    .project-panel.is-open .project-panel-sheet {
        transform: translateX(0);
    }

    .project-panel-close {
        position: absolute;
        top: var(--spacing-s);
        right: var(--spacing-s);
        border: none;
        background: transparent;
        font-size: 1.4rem;
        line-height: 1;
        cursor: pointer;
        color: var(--colour-fg-muted);
    }

    .project-panel-image-wrap {
        flex: 0 0 48%;
        overflow: hidden;
        border-bottom: 1px solid var(--colour-border);
        background: var(--colour-bg-muted);
    }

    .project-panel-image-wrap img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .project-panel-body {
        flex: 1;
        padding: var(--spacing-m);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-s);
        overflow-y: auto;
    }

    .panel-kicker {
        font-family: Montserrat, monospace;
        font-size: var(--font-size-xs);
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: var(--colour-fg-muted);
        margin-bottom: 0.25rem;
    }

    .panel-subtitle {
        font-size: var(--font-size-sm);
        color: var(--colour-fg-muted);
        margin-top: 0;
    }

    .panel-meta {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: var(--spacing-s);
        margin: var(--spacing-s) 0;
    }

    .panel-meta dt {
        font-family: Montserrat, monospace;
        font-size: var(--font-size-xs);
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--colour-fg-muted);
    }

    .panel-meta dd {
        margin: 0.15rem 0 0;
        font-size: var(--font-size-sm);
    }

    .panel-description {
        margin-top: var(--spacing-s);
        font-size: var(--font-size-base);
        line-height: 1.5;
    }

    @media (max-width: 768px) {
        .project-panel-sheet {
            width: 100%;
            box-shadow: 0 -18px 40px rgba(0, 0, 0, 0.35);
            top: auto;
            bottom: 0;
            height: min(80vh, 640px);
            border-radius: 16px 16px 0 0;
            transform: translateY(100%);
        }

        .project-panel.is-open .project-panel-sheet {
            transform: translateY(0);
        }

        .project-panel-image-wrap {
            display: none;
        }
    }
</style>

<script>
    // Theme toggle
    (function () {
        const root = document.documentElement;
        const btn = document.querySelector(".theme-toggle");
        const STORAGE_KEY = "portfolio-theme";

        const applyTheme = (theme) => {
            if (!root) return;
            if (theme === "dark") {
                root.setAttribute("data-theme", "dark");
            } else {
                root.removeAttribute("data-theme");
            }
        };

        const stored =
            typeof window !== "undefined"
                ? window.localStorage.getItem(STORAGE_KEY)
                : null;
        if (stored) {
            applyTheme(stored);
        }

        if (btn) {
            btn.addEventListener("click", () => {
                const isDark = root.getAttribute("data-theme") === "dark";
                const next = isDark ? "light" : "dark";
                applyTheme(next);
                if (typeof window !== "undefined") {
                    window.localStorage.setItem(STORAGE_KEY, next);
                }
            });
        }
    })();

    // Project side-sheet / bottom sheet
    (function () {
        const panel = document.getElementById("project-panel");
        if (!panel) return;

        const backdrop = panel.querySelector(".project-panel-backdrop");
        const closeBtn = panel.querySelector(".project-panel-close");

        const imgEl = document.getElementById("project-panel-image");
        const kickerEl = document.getElementById("project-panel-kicker");
        const titleEl = document.getElementById("project-panel-title");
        const subtitleEl = document.getElementById("project-panel-subtitle");
        const yearEl = document.getElementById("project-panel-year");
        const locationEl = document.getElementById("project-panel-location");
        const roleEl = document.getElementById("project-panel-role");
        const descEl = document.getElementById("project-panel-description");

        const openPanel = (tile) => {
            if (!tile) return;
            const title = tile.dataset.projectTitle || "";
            const subtitle = tile.dataset.projectSubtitle || "";
            const year = tile.dataset.projectYear || "";
            const location = tile.dataset.projectLocation || "";
            const role = tile.dataset.projectRole || "";
            const description = tile.dataset.projectDescription || "";
            const image = tile.dataset.projectImage || "";

            if (imgEl) {
                imgEl.src = image;
                imgEl.alt = title || subtitle || "Project image";
            }
            if (kickerEl) {
                const kickerParts = [];
                if (year) kickerParts.push(year);
                if (location) kickerParts.push(location);
                kickerEl.textContent = kickerParts.join(" · ");
            }
            if (titleEl) titleEl.textContent = title;
            if (subtitleEl) subtitleEl.textContent = subtitle;
            if (yearEl) yearEl.textContent = year;
            if (locationEl) locationEl.textContent = location;
            if (roleEl) roleEl.textContent = role;
            if (descEl) descEl.textContent = description;

            panel.classList.add("is-open");
            panel.setAttribute("aria-hidden", "false");
        };

        const closePanel = () => {
            panel.classList.remove("is-open");
            panel.setAttribute("aria-hidden", "true");
        };

        document.addEventListener("click", (event) => {
            const target = event.target;
            if (!target.closest) return;
            const tile = target.closest(".project-tile");
            if (tile) {
                event.preventDefault();
                openPanel(tile);
            }
        });

        [backdrop, closeBtn].forEach((el) => {
            if (!el) return;
            el.addEventListener("click", (event) => {
                event.preventDefault();
                closePanel();
            });
        });

        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape") {
                closePanel();
            }
        });
    })();
</script>
